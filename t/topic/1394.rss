<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>OTR XMPPèŠå¤©æ©Ÿå™¨äººâ€”â€”è­¦æƒ•XMPP-Matrixå‚€å„¡äººï¼ğŸ˜‚</title>
    <link>https://mlmmlm.icu/t/topic/1394</link>
    <description>èµ·åˆæ˜¯è½è½çœ‹çœ‹æˆ‘å°±æ˜¯åƒèˆ‡äº†å¯¦é©—çš„ï¼Œå¾Œä¾†ä»–æ‹’çµ•ä½¿ç”¨è‡ªç”±è»Ÿä»¶ï¼Œé›†é«”å­¸ç¿’æ•£äº†ï¼Œå†åŠ ä¸Šç„¡ç”¢éšç´šå°å³æŸçš„è¿½è¨ï¼Œä»–ä¹Ÿå°±å¾è‡ªç”±è»Ÿä»¶è£¡æ¶ˆå¤±äº†ã€‚

ä¸€èˆ¬ä¾†èªªï¼Œåœ‹å®‰å±€æŠŠä»–äººç•¶ä½œå‚€å„¡ï¼ˆå¥´å½¹ï¼‰ä¾†åƒèˆ‡XMPPå°ç¾¤çœ¾é‹å‹•é€²è¡Œå¤§é‡ç ´å£æ˜¯å¾ˆå¸¸è¦‹çš„ï¼Œå› è€Œé¦¬åˆ—ä¹‹è²è§£é«”å¾Œçµ„ç¹”ç©ºç¼ºçš„ä¸€å€‹é—œéµåŸå› å°±æ˜¯å‚€å„¡äººçš„å¤§é‡å­˜åœ¨å’Œl_g_dä¸ä»¥é¦¬åˆ—æ¯›ä¸»ç¾©ç‚ºæŒ‡å°é€²è¡Œè‡ªç”±è»Ÿä»¶é‹å‹•é€ æˆçš„ï¼›è€Œå……æ»¿äº†å‚€å„¡äººçš„XMPPå”è­°å°æ–¼ç„¡ç”¢éšç´šé©å‘½è€…ä¾†èªªï¼Œæ˜¯ä»–å€‘ä¸é¡˜æ„ç”¨çš„ï¼›è€Œå°ç¾¤çœ¾ä¾†èªªï¼Œå‰‡æ˜¯ä»–å€‘ç”¨ä¸æ‡‚çš„ã€‚å› è€Œé€ æˆé€™æ¨£ä¸€ç¨®ç¥å­¸æ¼«ç•«â€”â€”å³æ‰€æœ‰XMPPå”è­°çš„ç”¨æˆ¶å¤§éƒ½æ˜¯å‚€å„¡äººï¼Œé€²ä¸€æ­¥å°±æœƒå¾—å‡ºéƒ½æ˜¯æ©Ÿå™¨äººçš„éŒ¯èª¤çµè«–ï¼Œé€™å°æ–¼ä¸­åœ‹é¦¬åˆ—æ¯›ä¸»ç¾©è€…çš„æ‰“æ“Šæ˜¯ç©ºå‰æ¿€çƒˆçš„ï¼›æ˜¯ä½çƒˆåº¦æˆ°çˆ­çš„ä¸€éƒ¨åˆ†ã€‚

åœ‹å®‰å±€æŠŠä»–äººç•¶ä½œå‚€å„¡å¦„åœ–ç“¦è§£è‡ªç”±è»Ÿä»¶é‹å‹•çš„æ¨™èªŒå°±æ˜¯2021å¹´9æœˆ15æ—¥ä¸­æ–‡ç¶­åŸºå°ç¦7å€‹å¤§é™¸ç®¡ç†å“¡å’Œè§£é™¤12å€‹å¤§é™¸ç®¡ç†å“¡è·å‹™çš„äº‹ä»¶ï¼Œé€™äº›å‚€å„¡äººæˆ–å¤šæˆ–å°‘åœ°æ”¶äº†åœ‹å®‰å±€çš„å¥½è™•ï¼Œç‚ºæ³•è¥¿æ–¯ä¸»ç¾©è€Œæˆ°ï¼›å› è€Œè‡ªç”±è»Ÿä»¶é‹å‹•å°å‚€å„¡äººæ˜¯æŠµè§¸çš„ã€‚

**å‹¿å¿˜å‚€å„¡äººï¼å‹¿å¿˜XMPPç ´å£ç‹‚sina@404.cityï¼ï¼ˆä»–å’Œç‹æ˜Ÿå°Šå·®ä¸å¤šï¼‰åƒè¬ä¸è¦å¿˜è¨˜éšç´šé¬¥çˆ­ï¼**

ä¸­æ–‡ç¶­åŸºå°ç¦çš„å¤§é™¸ç”¨æˆ¶å¤§å¤šæ˜¯åœ‹å®‰å±€å‚€å„¡äººï¼›è€Œå°è³‡ç”¢éšç´šè‡ªç”±è»Ÿä»¶é‹å‹•çš„ç™¾ç§‘å…¨æ›¸ä¹Ÿæ˜¯ç„¡ç”¢éšç´šä¸é¡˜æ„ä½¿ç”¨çš„ã€‚

è«‹ä½¿ç”¨2021å¹´1æœˆçš„Profanityç‰ˆæœ¬é€²è¡Œè¦†è“‹æ¸¬è©¦ï¼š
https://mega.nz/folder/rGYlAZID#u5Ki-cSej3UpFbIpc6x2aA
ç›®å‰åƒ…é‡å°Profanityé€²è¡Œäº†ä¿®æ”¹ã€‚
æ•ˆæœæ˜¯åœ¨å»ºç«‹OTRé€£æ¥å¾Œç™¼é€ä¸€æ¢æ­¡è¿æ¶ˆæ¯ã€‚

åƒ…åƒ…æ˜¯æ‡‰ç­”æ©Ÿå™¨äººçš„è©±ï¼Œä¸¦ä¸éœ€è¦ä¿®æ”¹é‚£éº¼å¤šæ–‡ä»¶ï¼Œcmdæ–¹é¢fsendæ˜¯æ–°åŠ çš„å‘½ä»¤ï¼Œå› ç‚ºæˆ‘å˜—è©¦åœ¨Cèªè¨€OTRå”è­°ä¸­å¼•å…¥Pythonæ–‡ä»¶å‚³è¼¸ä»£ç¢¼ï¼Œå¾Œä¾†å› ç‚ºæœå‹™å™¨éŸ¿æ‡‰å¤ªæ…¢è€Œæ”¾æ£„äº†ã€‚

## ç‚ºäº†ç†è§£XMPP OTRæ€æ¨£åœ¨Profanityè£¡å·¥ä½œï¼Œå°±éœ€è¦ç‚ºæ¯å€‹å‡½æ•¸çš„èª¿ç”¨éƒ½åšå¥½è¨˜è™Ÿï¼ˆå³ï¼šcons_show(&quot;Function type:XXX.&quot;);ï¼‰ï¼Œé€™æ¨£å°±å¯ä»¥ç ”ç©¶XMPP OTRåœ¨Profanityè£¡çš„å·¥ä½œæµç¨‹äº†ã€‚

```
#ifdef HAVE_LIBOTR
void
chatwin_otr_secured(ProfChatWin *chatwin, gboolean trusted)
{
    assert(chatwin != NULL);

    chatwin-&gt;is_otr = TRUE;
    chatwin-&gt;otr_is_trusted = trusted;

    ProfWin *window = (ProfWin*) chatwin;
    if (trusted) {
        win_println(window, THEME_OTR_STARTED_TRUSTED, &#39;!&#39;, &quot;OTR session started (trusted).&quot;);
    } else {
        win_println(window, THEME_OTR_STARTED_UNTRUSTED, &#39;!&#39;, &quot;OTR session started (untrusted).&quot;);
    }

    if (wins_is_current(window)) {
         title_bar_switch();
    } else {
        int num = wins_get_num(window);
        status_bar_new(num, WIN_CHAT, chatwin-&gt;barejid);

        int ui_index = num;
        if (ui_index == 10) {
            ui_index = 0;
        }
        cons_show(&quot;%s started an OTR session (%d).&quot;, chatwin-&gt;barejid, ui_index);
        cons_alert();
	otr_on_message_send(chatwin,&quot;æ¬¢è¿è¿æ¥XMPP OTR MLMå›¾ä¹¦é¦†ï¼Œè¾“å…¥/helpæŸ¥è¯¢å¯ä½¿ç”¨çš„å‘½ä»¤ã€‚&quot;,true);
	//char *id = message_send_chat_otr(chatwin-&gt;barejid,&quot;æ¬¢è¿è¿æ¥XMPP OTR MLMå›¾ä¹¦é¦†ï¼Œè¾“å…¥/helpæŸ¥è¯¢å¯ä½¿ç”¨çš„å‘½ä»¤ã€‚&quot;, FALSE);free(id);//è¿™ä¸ªå‘é€çš„æ˜¯æœªåŠ å¯†çš„æ¶ˆæ¯ï¼
    }
}
```


```
char*
otr_on_message_recv(const char *const barejid, const char *const resource, const char *const message, gboolean *decrypted)
{
    //cons_show(&quot;OTRæ¶ˆæ¯æ¥æ”¶&quot;);
    //cons_show(barejid);
    //cons_show(resource);
    //if(decrypted){cons_show(&quot;decrypted&quot;);}else{cons_show(&quot;not decrypted&quot;);}
    prof_otrpolicy_t policy = otr_get_policy(barejid);
    char *whitespace_base = strstr(message, OTRL_MESSAGE_TAG_BASE);

    //check for OTR whitespace (opportunistic or always)
    if (policy == PROF_OTRPOLICY_OPPORTUNISTIC || policy == PROF_OTRPOLICY_ALWAYS) {
        if (whitespace_base) {
            if (strstr(message, OTRL_MESSAGE_TAG_V2) || strstr(message, OTRL_MESSAGE_TAG_V1)) {
                // Remove whitespace pattern for proper display in UI
                // Handle both BASE+TAGV1/2(16+8) and BASE+TAGV1+TAGV2(16+8+8)
                int tag_length = 24;
                if (strstr(message, OTRL_MESSAGE_TAG_V2) &amp;&amp; strstr(message, OTRL_MESSAGE_TAG_V1)) {
                    tag_length = 32;
                }
                memmove(whitespace_base, whitespace_base+tag_length, tag_length);
                char *otr_query_message = otr_start_query();
                cons_show(&quot;OTR Whitespace pattern detected. Attempting to start OTR session...&quot;);
                char *id = message_send_chat_otr(barejid, otr_query_message, FALSE);
                free(id);
            }
        }
    }

    char *newmessage = otr_decrypt_message(barejid, message, decrypted);
    if (!newmessage) { // internal OTR message
        return NULL;
    }

    if (policy == PROF_OTRPOLICY_ALWAYS &amp;&amp; *decrypted == FALSE &amp;&amp; !whitespace_base) {
        char *otr_query_message = otr_start_query();
        cons_show(&quot;Attempting to start OTR session...&quot;);
        char *id = message_send_chat_otr(barejid, otr_query_message, FALSE);
        free(id);
    }
    cons_show(&quot;è§£å¯†äº†æ¶ˆæ¯ï¼š&quot;);
    cons_show(newmessage);
    return newmessage;
}

gboolean
otr_on_message_send(ProfChatWin *chatwin, const char *const message, gboolean request_receipt)
{
    cons_show(&quot;Function type:16.&quot;);
    char *id = NULL;
    prof_otrpolicy_t policy = otr_get_policy(chatwin-&gt;barejid);

    // Send encrypted message
    if (otr_is_secure(chatwin-&gt;barejid)) {
        char *encrypted = otr_encrypt_message(chatwin-&gt;barejid, message);
        if (encrypted) {
            id = message_send_chat_otr(chatwin-&gt;barejid, encrypted, request_receipt);
            chat_log_otr_msg_out(chatwin-&gt;barejid, message);
            chatwin_outgoing_msg(chatwin, message, id, PROF_MSG_ENC_OTR, request_receipt);
            otr_free_message(encrypted);
            free(id);
            return TRUE;
        } else {
            win_println((ProfWin*)chatwin, THEME_ERROR, &#39;-&#39;, &quot;%s&quot;, &quot;Failed to encrypt and send message.&quot;);
            return TRUE;
        }
    }

    // show error if not secure and policy always
    if (policy == PROF_OTRPOLICY_ALWAYS) {
        win_println((ProfWin*)chatwin, THEME_ERROR, &#39;-&#39;, &quot;%s&quot;, &quot;Failed to send message. OTR policy set to: always&quot;);
        return TRUE;
    }

    // tag and send for policy opportunistic
    if (policy == PROF_OTRPOLICY_OPPORTUNISTIC) {
        char *otr_tagged_msg = otr_tag_message(message);
        id = message_send_chat_otr(chatwin-&gt;barejid, otr_tagged_msg, request_receipt);
        chatwin_outgoing_msg(chatwin, message, id, PROF_MSG_ENC_PLAIN, request_receipt);
        chat_log_msg_out(chatwin-&gt;barejid, message);
        free(otr_tagged_msg);
        free(id);
        return TRUE;
    }

    return FALSE;
}
```

ä¸€èªªå‚€å„¡æˆ‘å°±ï½å“¦å“¦å“¦ï½

1.åå‹•çš„ç¤¾æœƒä¸»ç¾©
ï¼ˆç”²ï¼‰å°å»ºçš„ç¤¾æœƒä¸»ç¾©
æ³•åœ‹å’Œè‹±åœ‹çš„è²´æ—ï¼ŒæŒ‰ç…§ä»–å€‘çš„æ­·å²åœ°ä½æ‰€è² çš„ä½¿å‘½ï¼Œå°±æ˜¯å¯«ä¸€äº›æŠ¨æ“Šç¾ä»£è³‡ç”¢éšç´šç¤¾æœƒçš„ä½œå“ã€‚ åœ¨æ³•åœ‹çš„1830å¹´ä¸ƒæœˆé©å‘½å’Œè‹±åœ‹çš„æ”¹é©é‹å‹•ä¸­ï¼Œä»–å€‘å†ä¸€æ¬¡è¢«å¯æ¨çš„æš´ç™¼æˆ¶æ‰“æ•—äº†ã€‚ å¾æ­¤å°±å†è«‡ä¸ä¸Šåš´é‡çš„æ”¿æ²»é¬¥çˆ­äº†ã€‚ ä»–å€‘é‚„èƒ½é€²è¡Œçš„åªæ˜¯æ–‡å­—é¬¥çˆ­ã€‚ ä½†æ˜¯ï¼Œå³ä½¿åœ¨æ–‡å­—æ–¹é¢ä¹Ÿä¸å¯èƒ½é‡å½ˆå¾©è¾Ÿæ™‚æœŸçš„è€èª¿äº†ã€‚ ç‚ºäº†æ¿€èµ·åŒæƒ…ï¼Œè²´æ—å€‘ä¸å¾—ä¸è£æ¨¡åšæ¨£ï¼Œä¼¼ä¹ä»–å€‘å·²ç¶“ä¸é—œå¿ƒè‡ªèº«çš„åˆ©ç›Šï¼Œåªæ˜¯ç‚ºäº†è¢«å‰å‰Šçš„å·¥äººéšç´šçš„åˆ©ç›Šæ‰å»å¯«å°è³‡ç”¢éšç´šçš„æ§è¨´æ›¸ã€‚ ä»–å€‘ç”¨ä¾†æ´©æ†¤çš„æ‰‹æ®µæ˜¯ï¼šå”±å”±è©›å’’ä»–å€‘çš„æ–°çµ±æ²»è€…çš„æ­Œï¼Œä¸¦å‘ä»–å˜°å˜°å’•å’•åœ°èªªä¸€äº›æˆ–å¤šæˆ–å°‘å…‡éšªçš„é è¨€ã€‚
é€™æ¨£å°±ç”¢ç”Ÿäº†å°å»ºçš„ç¤¾æœƒä¸»ç¾©ï¼ŒåŠæ˜¯æŒ½æ­Œï¼ŒåŠæ˜¯è¬—æ–‡ï¼› åŠæ˜¯éå»çš„å›éŸ³ï¼ŒåŠæ˜¯æœªä¾†çš„æ«åš‡ï¼› å®ƒæœ‰æ™‚ä¹Ÿèƒ½ç”¨è¾›è¾£ã€ä¿çš®è€Œå°–åˆ»çš„è©•è«–åˆºä¸­è³‡ç”¢éšç´šçš„å¿ƒï¼Œä½†æ˜¯å®ƒç”±æ–¼å®Œå…¨ä¸èƒ½ç†è§£ç¾ä»£æ­·å²çš„é€²ç¨‹è€Œç¸½æ˜¯ä»¤äººæ„Ÿåˆ°å¯ç¬‘ã€‚
ç‚ºäº†æ‹‰æ”äººæ°‘ï¼Œè²´æ—å€‘æŠŠç„¡ç”¢éšç´šçš„ä¹é£Ÿè¢‹ç•¶åšæ——å¹Ÿä¾†æ®èˆã€‚ ä½†æ˜¯ï¼Œæ¯ç•¶äººæ°‘è·Ÿè‘—ä»–å€‘èµ°çš„æ™‚å€™ï¼Œéƒ½ç™¼ç¾ä»–å€‘çš„è‡€éƒ¨å¸¶æœ‰èˆŠçš„å°å»ºç´‹ç« ï¼Œæ–¼æ˜¯å°±å“ˆå“ˆå¤§ç¬‘ï¼Œä¸€å“„è€Œæ•£ã€‚
ä¸€éƒ¨åˆ†æ³•åœ‹æ­£çµ±æ´¾å’Œâ€œé’å¹´è‹±åœ‹â€ï¼Œéƒ½æ¼”éé€™å‡ºæˆ²ã€‚
å°å»ºä¸»èªªï¼Œä»–å€‘çš„å‰å‰Šç®¡é“å’Œè³‡ç”¢éšç´šçš„å‰å‰Šä¸åŒï¼Œé‚£ä»–å€‘åªæ˜¯å¿˜è¨˜äº†ï¼Œä»–å€‘æ˜¯åœ¨å®Œå…¨ä¸åŒçš„ã€ç¾æ™‚å·²ç¶“éæ™‚çš„æƒ…å†µå’Œæ¢ä»¶ä¸‹é€²è¡Œå‰å‰Šçš„ã€‚ ä»–å€‘èªªï¼Œåœ¨ä»–å€‘çš„çµ±æ²»ä¸‹ä¸¦æ²’æœ‰å‡ºç¾éç¾ä»£çš„ç„¡ç”¢éšç´šï¼Œé‚£ä»–å€‘åªæ˜¯å¿˜è¨˜äº†ï¼Œç¾ä»£çš„è³‡ç”¢éšç´šæ­£æ˜¯ä»–å€‘çš„ç¤¾æœƒåˆ¶åº¦çš„å¿…ç„¶ç”¢ç‰©ã€‚
ä¸éï¼Œä»–å€‘æ¯«ä¸æ©é£¾è‡ªå·±çš„è²¬å‚™çš„åå‹•æ€§è³ªï¼Œä»–å€‘æ§å‘Šè³‡ç”¢éšç´šçš„ä¸»è¦ç½ªç‹€æ­£æ˜¯åœ¨æ–¼ï¼šåœ¨è³‡ç”¢éšç´šçš„çµ±æ²»ä¸‹æœ‰ä¸€å€‹å°‡æŠŠæ•´å€‹èˆŠç¤¾æœƒåˆ¶åº¦ç‚¸æ¯€çš„éšç´šç™¼å±•èµ·ä¾†ã€‚
ä»–å€‘è²¬å‚™è³‡ç”¢éšç´šï¼Œèˆ‡å…¶èªªæ˜¯å› ç‚ºå®ƒç”¢ç”Ÿäº†ç„¡ç”¢éšç´šï¼Œä¸å¦‚èªªæ˜¯å› ç‚ºå®ƒç”¢ç”Ÿäº†é©å‘½çš„ç„¡ç”¢éšç´šã€‚
å›™æ­¤ï¼Œåœ¨æ”¿æ²»å¯¦è¸ä¸­ï¼Œä»–å€‘åƒèˆ‡å°å·¥äººéšç´šæ¡å–çš„ä¸€åˆ‡æš´åŠ›æªæ–½ï¼Œåœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œä»–å€‘é•èƒŒè‡ªå·±çš„é‚£ä¸€å¥—å† å†•å ‚çš‡çš„è¨€è©ï¼Œå±ˆå°Šæ‹¾å–é‡‘è˜‹æœï¼Œä¸é¡§ä¿¡ç¾©ã€ä»æ„›å’Œåè­½å»åšç¾Šæ¯›ã€ç´…èœé ­å’Œç‡’é…’çš„è²·è³£ã€‚
æ­£å¦‚åƒ§ä¾¶ç¸½æ˜¯åŒå°å»ºä¸»æ”œæ‰‹åŒè¡Œä¸€æ¨£ï¼Œåƒ§ä¾¶çš„ç¤¾æœƒä¸»ç¾©ä¹Ÿç¸½æ˜¯åŒå°å»ºçš„ç¤¾æœƒä¸»ç¾©æ”œæ‰‹åŒè¡Œçš„ã€‚
è¦çµ¦åŸºç£æ•™ç¦æ¬²ä¸»ç¾©å¡—ä¸Šä¸€å±¤ç¤¾æœƒä¸»ç¾©çš„è‰²å½©ï¼Œæ˜¯å†å®¹æ˜“ä¸éäº†ã€‚ åŸºç£æ•™ä¸æ˜¯ä¹Ÿæ¿€çƒˆåå°ç§æœ‰åˆ¶ï¼Œåå°å©šå§»ï¼Œåå°åœ‹å®¶å—ï¼Ÿ å®ƒä¸æ˜¯æå€¡ç”¨è¡Œå–„å’Œæ±‚ä¹ã€ç¨èº«å’Œç¦æ¬²ã€ä¿®é“å’Œç¦®æ‹œä¾†ä»£æ›¿é€™ä¸€åˆ‡å—ï¼Ÿ åŸºç£æ•™çš„ç¤¾æœƒä¸»ç¾©ï¼Œåªä¸éæ˜¯åƒ§ä¾¶ç”¨ä¾†ä½¿è²´æ—çš„æ€¨æ†¤ç¥è–åŒ–çš„è–æ°´ç½·äº†ã€‚
ï¼ˆä¹™ï¼‰å°è³‡ç”¢éšç´šçš„ç¤¾æœƒä¸»ç¾©
ï¼ˆå…§å®¹è¦‹åƒè€ƒè³‡æ–™9ï¼‰
ï¼ˆä¸™ï¼‰å¾·åœ‹çš„æˆ–â€œçœŸæ­£çš„â€ç¤¾æœƒä¸»ç¾©
ï¼ˆå…§å®¹è¦‹åƒè€ƒè³‡æ–™9ï¼‰</description>
    <language>zh-CN</language>
    <lastBuildDate>Wed, 07 Sep 2022 05:06:36 +0000</lastBuildDate>
    <category>æŠ€æœ¯</category>
    <atom:link href="https://mlmmlm.icu/t/topic/1394.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>OTR XMPPèŠå¤©æ©Ÿå™¨äººâ€”â€”è­¦æƒ•XMPP-Matrixå‚€å„¡äººï¼ğŸ˜‚</title>
        <dc:creator><![CDATA[Xuan_JunHe]]></dc:creator>
        <description><![CDATA[
            <p>èµ·åˆæ˜¯è½è½çœ‹çœ‹æˆ‘å°±æ˜¯åƒèˆ‡äº†å¯¦é©—çš„ï¼Œå¾Œä¾†ä»–æ‹’çµ•ä½¿ç”¨è‡ªç”±è»Ÿä»¶ï¼Œé›†é«”å­¸ç¿’æ•£äº†ï¼Œå†åŠ ä¸Šç„¡ç”¢éšç´šå°å³æŸçš„è¿½è¨ï¼Œä»–ä¹Ÿå°±å¾è‡ªç”±è»Ÿä»¶è£¡æ¶ˆå¤±äº†ã€‚</p>
<p>ä¸€èˆ¬ä¾†èªªï¼Œåœ‹å®‰å±€æŠŠä»–äººç•¶ä½œå‚€å„¡ï¼ˆå¥´å½¹ï¼‰ä¾†åƒèˆ‡XMPPå°ç¾¤çœ¾é‹å‹•é€²è¡Œå¤§é‡ç ´å£æ˜¯å¾ˆå¸¸è¦‹çš„ï¼Œå› è€Œé¦¬åˆ—ä¹‹è²è§£é«”å¾Œçµ„ç¹”ç©ºç¼ºçš„ä¸€å€‹é—œéµåŸå› å°±æ˜¯å‚€å„¡äººçš„å¤§é‡å­˜åœ¨å’Œl_g_dä¸ä»¥é¦¬åˆ—æ¯›ä¸»ç¾©ç‚ºæŒ‡å°é€²è¡Œè‡ªç”±è»Ÿä»¶é‹å‹•é€ æˆçš„ï¼›è€Œå……æ»¿äº†å‚€å„¡äººçš„XMPPå”è­°å°æ–¼ç„¡ç”¢éšç´šé©å‘½è€…ä¾†èªªï¼Œæ˜¯ä»–å€‘ä¸é¡˜æ„ç”¨çš„ï¼›è€Œå°ç¾¤çœ¾ä¾†èªªï¼Œå‰‡æ˜¯ä»–å€‘ç”¨ä¸æ‡‚çš„ã€‚å› è€Œé€ æˆé€™æ¨£ä¸€ç¨®ç¥å­¸æ¼«ç•«â€”â€”å³æ‰€æœ‰XMPPå”è­°çš„ç”¨æˆ¶å¤§éƒ½æ˜¯å‚€å„¡äººï¼Œé€²ä¸€æ­¥å°±æœƒå¾—å‡ºéƒ½æ˜¯æ©Ÿå™¨äººçš„éŒ¯èª¤çµè«–ï¼Œé€™å°æ–¼ä¸­åœ‹é¦¬åˆ—æ¯›ä¸»ç¾©è€…çš„æ‰“æ“Šæ˜¯ç©ºå‰æ¿€çƒˆçš„ï¼›æ˜¯ä½çƒˆåº¦æˆ°çˆ­çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>åœ‹å®‰å±€æŠŠä»–äººç•¶ä½œå‚€å„¡å¦„åœ–ç“¦è§£è‡ªç”±è»Ÿä»¶é‹å‹•çš„æ¨™èªŒå°±æ˜¯2021å¹´9æœˆ15æ—¥ä¸­æ–‡ç¶­åŸºå°ç¦7å€‹å¤§é™¸ç®¡ç†å“¡å’Œè§£é™¤12å€‹å¤§é™¸ç®¡ç†å“¡è·å‹™çš„äº‹ä»¶ï¼Œé€™äº›å‚€å„¡äººæˆ–å¤šæˆ–å°‘åœ°æ”¶äº†åœ‹å®‰å±€çš„å¥½è™•ï¼Œç‚ºæ³•è¥¿æ–¯ä¸»ç¾©è€Œæˆ°ï¼›å› è€Œè‡ªç”±è»Ÿä»¶é‹å‹•å°å‚€å„¡äººæ˜¯æŠµè§¸çš„ã€‚</p>
<p><strong>å‹¿å¿˜å‚€å„¡äººï¼å‹¿å¿˜XMPPç ´å£ç‹‚sina@404.cityï¼ï¼ˆä»–å’Œç‹æ˜Ÿå°Šå·®ä¸å¤šï¼‰åƒè¬ä¸è¦å¿˜è¨˜éšç´šé¬¥çˆ­ï¼</strong></p>
<p>ä¸­æ–‡ç¶­åŸºå°ç¦çš„å¤§é™¸ç”¨æˆ¶å¤§å¤šæ˜¯åœ‹å®‰å±€å‚€å„¡äººï¼›è€Œå°è³‡ç”¢éšç´šè‡ªç”±è»Ÿä»¶é‹å‹•çš„ç™¾ç§‘å…¨æ›¸ä¹Ÿæ˜¯ç„¡ç”¢éšç´šä¸é¡˜æ„ä½¿ç”¨çš„ã€‚</p>
<p>è«‹ä½¿ç”¨2021å¹´1æœˆçš„Profanityç‰ˆæœ¬é€²è¡Œè¦†è“‹æ¸¬è©¦ï¼š</p><aside class="onebox allowlistedgeneric" data-onebox-src="https://mega.nz/folder/rGYlAZID#u5Ki-cSej3UpFbIpc6x2aA">
  <header class="source">
      <img src="https://mlmmlm.icu/uploads/default/original/2X/d/d034010903f41636bd3e9cd6589a68bca64d7d43.png" class="site-icon" width="" height="">

      <a href="https://mega.nz/folder/rGYlAZID#u5Ki-cSej3UpFbIpc6x2aA" target="_blank" rel="noopener nofollow ugc">mega.nz</a>
  </header>

  <article class="onebox-body">
    <img src="https://mlmmlm.icu/uploads/default/original/2X/6/646b383f14a90eec1945726c9b3aaa1870cb263c.png" class="thumbnail" width="" height="">

<h3><a href="https://mega.nz/folder/rGYlAZID#u5Ki-cSej3UpFbIpc6x2aA" target="_blank" rel="noopener nofollow ugc">6.66 MB folder on MEGA</a></h3>

  <p>20 files and 7 subfolders</p>


  </article>

  <div class="onebox-metadata">
    
    
  </div>

  <div style="clear: both"></div>
</aside>
<p>
ç›®å‰åƒ…é‡å°Profanityé€²è¡Œäº†ä¿®æ”¹ã€‚<br>
æ•ˆæœæ˜¯åœ¨å»ºç«‹OTRé€£æ¥å¾Œç™¼é€ä¸€æ¢æ­¡è¿æ¶ˆæ¯ã€‚</p>
<p>åƒ…åƒ…æ˜¯æ‡‰ç­”æ©Ÿå™¨äººçš„è©±ï¼Œä¸¦ä¸éœ€è¦ä¿®æ”¹é‚£éº¼å¤šæ–‡ä»¶ï¼Œcmdæ–¹é¢fsendæ˜¯æ–°åŠ çš„å‘½ä»¤ï¼Œå› ç‚ºæˆ‘å˜—è©¦åœ¨Cèªè¨€OTRå”è­°ä¸­å¼•å…¥Pythonæ–‡ä»¶å‚³è¼¸ä»£ç¢¼ï¼Œå¾Œä¾†å› ç‚ºæœå‹™å™¨éŸ¿æ‡‰å¤ªæ…¢è€Œæ”¾æ£„äº†ã€‚</p>
<h2>
<a name="xmpp-otrprofanitycons_showfunction-typexxxxmpp-otrprofanity-1" class="anchor" href="https://mlmmlm.icu#xmpp-otrprofanitycons_showfunction-typexxxxmpp-otrprofanity-1"></a>ç‚ºäº†ç†è§£XMPP OTRæ€æ¨£åœ¨Profanityè£¡å·¥ä½œï¼Œå°±éœ€è¦ç‚ºæ¯å€‹å‡½æ•¸çš„èª¿ç”¨éƒ½åšå¥½è¨˜è™Ÿï¼ˆå³ï¼šcons_show(â€œFunction type:XXX.â€);ï¼‰ï¼Œé€™æ¨£å°±å¯ä»¥ç ”ç©¶XMPP OTRåœ¨Profanityè£¡çš„å·¥ä½œæµç¨‹äº†ã€‚</h2>
<pre><code class="lang-auto">#ifdef HAVE_LIBOTR
void
chatwin_otr_secured(ProfChatWin *chatwin, gboolean trusted)
{
    assert(chatwin != NULL);

    chatwin-&gt;is_otr = TRUE;
    chatwin-&gt;otr_is_trusted = trusted;

    ProfWin *window = (ProfWin*) chatwin;
    if (trusted) {
        win_println(window, THEME_OTR_STARTED_TRUSTED, '!', "OTR session started (trusted).");
    } else {
        win_println(window, THEME_OTR_STARTED_UNTRUSTED, '!', "OTR session started (untrusted).");
    }

    if (wins_is_current(window)) {
         title_bar_switch();
    } else {
        int num = wins_get_num(window);
        status_bar_new(num, WIN_CHAT, chatwin-&gt;barejid);

        int ui_index = num;
        if (ui_index == 10) {
            ui_index = 0;
        }
        cons_show("%s started an OTR session (%d).", chatwin-&gt;barejid, ui_index);
        cons_alert();
	otr_on_message_send(chatwin,"æ¬¢è¿è¿æ¥XMPP OTR MLMå›¾ä¹¦é¦†ï¼Œè¾“å…¥/helpæŸ¥è¯¢å¯ä½¿ç”¨çš„å‘½ä»¤ã€‚",true);
	//char *id = message_send_chat_otr(chatwin-&gt;barejid,"æ¬¢è¿è¿æ¥XMPP OTR MLMå›¾ä¹¦é¦†ï¼Œè¾“å…¥/helpæŸ¥è¯¢å¯ä½¿ç”¨çš„å‘½ä»¤ã€‚", FALSE);free(id);//è¿™ä¸ªå‘é€çš„æ˜¯æœªåŠ å¯†çš„æ¶ˆæ¯ï¼
    }
}
</code></pre>
<pre><code class="lang-auto">char*
otr_on_message_recv(const char *const barejid, const char *const resource, const char *const message, gboolean *decrypted)
{
    //cons_show("OTRæ¶ˆæ¯æ¥æ”¶");
    //cons_show(barejid);
    //cons_show(resource);
    //if(decrypted){cons_show("decrypted");}else{cons_show("not decrypted");}
    prof_otrpolicy_t policy = otr_get_policy(barejid);
    char *whitespace_base = strstr(message, OTRL_MESSAGE_TAG_BASE);

    //check for OTR whitespace (opportunistic or always)
    if (policy == PROF_OTRPOLICY_OPPORTUNISTIC || policy == PROF_OTRPOLICY_ALWAYS) {
        if (whitespace_base) {
            if (strstr(message, OTRL_MESSAGE_TAG_V2) || strstr(message, OTRL_MESSAGE_TAG_V1)) {
                // Remove whitespace pattern for proper display in UI
                // Handle both BASE+TAGV1/2(16+8) and BASE+TAGV1+TAGV2(16+8+8)
                int tag_length = 24;
                if (strstr(message, OTRL_MESSAGE_TAG_V2) &amp;&amp; strstr(message, OTRL_MESSAGE_TAG_V1)) {
                    tag_length = 32;
                }
                memmove(whitespace_base, whitespace_base+tag_length, tag_length);
                char *otr_query_message = otr_start_query();
                cons_show("OTR Whitespace pattern detected. Attempting to start OTR session...");
                char *id = message_send_chat_otr(barejid, otr_query_message, FALSE);
                free(id);
            }
        }
    }

    char *newmessage = otr_decrypt_message(barejid, message, decrypted);
    if (!newmessage) { // internal OTR message
        return NULL;
    }

    if (policy == PROF_OTRPOLICY_ALWAYS &amp;&amp; *decrypted == FALSE &amp;&amp; !whitespace_base) {
        char *otr_query_message = otr_start_query();
        cons_show("Attempting to start OTR session...");
        char *id = message_send_chat_otr(barejid, otr_query_message, FALSE);
        free(id);
    }
    cons_show("è§£å¯†äº†æ¶ˆæ¯ï¼š");
    cons_show(newmessage);
    return newmessage;
}

gboolean
otr_on_message_send(ProfChatWin *chatwin, const char *const message, gboolean request_receipt)
{
    cons_show("Function type:16.");
    char *id = NULL;
    prof_otrpolicy_t policy = otr_get_policy(chatwin-&gt;barejid);

    // Send encrypted message
    if (otr_is_secure(chatwin-&gt;barejid)) {
        char *encrypted = otr_encrypt_message(chatwin-&gt;barejid, message);
        if (encrypted) {
            id = message_send_chat_otr(chatwin-&gt;barejid, encrypted, request_receipt);
            chat_log_otr_msg_out(chatwin-&gt;barejid, message);
            chatwin_outgoing_msg(chatwin, message, id, PROF_MSG_ENC_OTR, request_receipt);
            otr_free_message(encrypted);
            free(id);
            return TRUE;
        } else {
            win_println((ProfWin*)chatwin, THEME_ERROR, '-', "%s", "Failed to encrypt and send message.");
            return TRUE;
        }
    }

    // show error if not secure and policy always
    if (policy == PROF_OTRPOLICY_ALWAYS) {
        win_println((ProfWin*)chatwin, THEME_ERROR, '-', "%s", "Failed to send message. OTR policy set to: always");
        return TRUE;
    }

    // tag and send for policy opportunistic
    if (policy == PROF_OTRPOLICY_OPPORTUNISTIC) {
        char *otr_tagged_msg = otr_tag_message(message);
        id = message_send_chat_otr(chatwin-&gt;barejid, otr_tagged_msg, request_receipt);
        chatwin_outgoing_msg(chatwin, message, id, PROF_MSG_ENC_PLAIN, request_receipt);
        chat_log_msg_out(chatwin-&gt;barejid, message);
        free(otr_tagged_msg);
        free(id);
        return TRUE;
    }

    return FALSE;
}
</code></pre>
<p>ä¸€èªªå‚€å„¡æˆ‘å°±ï½å“¦å“¦å“¦ï½</p>
<p>1.åå‹•çš„ç¤¾æœƒä¸»ç¾©<br>
ï¼ˆç”²ï¼‰å°å»ºçš„ç¤¾æœƒä¸»ç¾©<br>
æ³•åœ‹å’Œè‹±åœ‹çš„è²´æ—ï¼ŒæŒ‰ç…§ä»–å€‘çš„æ­·å²åœ°ä½æ‰€è² çš„ä½¿å‘½ï¼Œå°±æ˜¯å¯«ä¸€äº›æŠ¨æ“Šç¾ä»£è³‡ç”¢éšç´šç¤¾æœƒçš„ä½œå“ã€‚ åœ¨æ³•åœ‹çš„1830å¹´ä¸ƒæœˆé©å‘½å’Œè‹±åœ‹çš„æ”¹é©é‹å‹•ä¸­ï¼Œä»–å€‘å†ä¸€æ¬¡è¢«å¯æ¨çš„æš´ç™¼æˆ¶æ‰“æ•—äº†ã€‚ å¾æ­¤å°±å†è«‡ä¸ä¸Šåš´é‡çš„æ”¿æ²»é¬¥çˆ­äº†ã€‚ ä»–å€‘é‚„èƒ½é€²è¡Œçš„åªæ˜¯æ–‡å­—é¬¥çˆ­ã€‚ ä½†æ˜¯ï¼Œå³ä½¿åœ¨æ–‡å­—æ–¹é¢ä¹Ÿä¸å¯èƒ½é‡å½ˆå¾©è¾Ÿæ™‚æœŸçš„è€èª¿äº†ã€‚ ç‚ºäº†æ¿€èµ·åŒæƒ…ï¼Œè²´æ—å€‘ä¸å¾—ä¸è£æ¨¡åšæ¨£ï¼Œä¼¼ä¹ä»–å€‘å·²ç¶“ä¸é—œå¿ƒè‡ªèº«çš„åˆ©ç›Šï¼Œåªæ˜¯ç‚ºäº†è¢«å‰å‰Šçš„å·¥äººéšç´šçš„åˆ©ç›Šæ‰å»å¯«å°è³‡ç”¢éšç´šçš„æ§è¨´æ›¸ã€‚ ä»–å€‘ç”¨ä¾†æ´©æ†¤çš„æ‰‹æ®µæ˜¯ï¼šå”±å”±è©›å’’ä»–å€‘çš„æ–°çµ±æ²»è€…çš„æ­Œï¼Œä¸¦å‘ä»–å˜°å˜°å’•å’•åœ°èªªä¸€äº›æˆ–å¤šæˆ–å°‘å…‡éšªçš„é è¨€ã€‚<br>
é€™æ¨£å°±ç”¢ç”Ÿäº†å°å»ºçš„ç¤¾æœƒä¸»ç¾©ï¼ŒåŠæ˜¯æŒ½æ­Œï¼ŒåŠæ˜¯è¬—æ–‡ï¼› åŠæ˜¯éå»çš„å›éŸ³ï¼ŒåŠæ˜¯æœªä¾†çš„æ«åš‡ï¼› å®ƒæœ‰æ™‚ä¹Ÿèƒ½ç”¨è¾›è¾£ã€ä¿çš®è€Œå°–åˆ»çš„è©•è«–åˆºä¸­è³‡ç”¢éšç´šçš„å¿ƒï¼Œä½†æ˜¯å®ƒç”±æ–¼å®Œå…¨ä¸èƒ½ç†è§£ç¾ä»£æ­·å²çš„é€²ç¨‹è€Œç¸½æ˜¯ä»¤äººæ„Ÿåˆ°å¯ç¬‘ã€‚<br>
ç‚ºäº†æ‹‰æ”äººæ°‘ï¼Œè²´æ—å€‘æŠŠç„¡ç”¢éšç´šçš„ä¹é£Ÿè¢‹ç•¶åšæ——å¹Ÿä¾†æ®èˆã€‚ ä½†æ˜¯ï¼Œæ¯ç•¶äººæ°‘è·Ÿè‘—ä»–å€‘èµ°çš„æ™‚å€™ï¼Œéƒ½ç™¼ç¾ä»–å€‘çš„è‡€éƒ¨å¸¶æœ‰èˆŠçš„å°å»ºç´‹ç« ï¼Œæ–¼æ˜¯å°±å“ˆå“ˆå¤§ç¬‘ï¼Œä¸€å“„è€Œæ•£ã€‚<br>
ä¸€éƒ¨åˆ†æ³•åœ‹æ­£çµ±æ´¾å’Œâ€œé’å¹´è‹±åœ‹â€ï¼Œéƒ½æ¼”éé€™å‡ºæˆ²ã€‚<br>
å°å»ºä¸»èªªï¼Œä»–å€‘çš„å‰å‰Šç®¡é“å’Œè³‡ç”¢éšç´šçš„å‰å‰Šä¸åŒï¼Œé‚£ä»–å€‘åªæ˜¯å¿˜è¨˜äº†ï¼Œä»–å€‘æ˜¯åœ¨å®Œå…¨ä¸åŒçš„ã€ç¾æ™‚å·²ç¶“éæ™‚çš„æƒ…å†µå’Œæ¢ä»¶ä¸‹é€²è¡Œå‰å‰Šçš„ã€‚ ä»–å€‘èªªï¼Œåœ¨ä»–å€‘çš„çµ±æ²»ä¸‹ä¸¦æ²’æœ‰å‡ºç¾éç¾ä»£çš„ç„¡ç”¢éšç´šï¼Œé‚£ä»–å€‘åªæ˜¯å¿˜è¨˜äº†ï¼Œç¾ä»£çš„è³‡ç”¢éšç´šæ­£æ˜¯ä»–å€‘çš„ç¤¾æœƒåˆ¶åº¦çš„å¿…ç„¶ç”¢ç‰©ã€‚<br>
ä¸éï¼Œä»–å€‘æ¯«ä¸æ©é£¾è‡ªå·±çš„è²¬å‚™çš„åå‹•æ€§è³ªï¼Œä»–å€‘æ§å‘Šè³‡ç”¢éšç´šçš„ä¸»è¦ç½ªç‹€æ­£æ˜¯åœ¨æ–¼ï¼šåœ¨è³‡ç”¢éšç´šçš„çµ±æ²»ä¸‹æœ‰ä¸€å€‹å°‡æŠŠæ•´å€‹èˆŠç¤¾æœƒåˆ¶åº¦ç‚¸æ¯€çš„éšç´šç™¼å±•èµ·ä¾†ã€‚<br>
ä»–å€‘è²¬å‚™è³‡ç”¢éšç´šï¼Œèˆ‡å…¶èªªæ˜¯å› ç‚ºå®ƒç”¢ç”Ÿäº†ç„¡ç”¢éšç´šï¼Œä¸å¦‚èªªæ˜¯å› ç‚ºå®ƒç”¢ç”Ÿäº†é©å‘½çš„ç„¡ç”¢éšç´šã€‚<br>
å›™æ­¤ï¼Œåœ¨æ”¿æ²»å¯¦è¸ä¸­ï¼Œä»–å€‘åƒèˆ‡å°å·¥äººéšç´šæ¡å–çš„ä¸€åˆ‡æš´åŠ›æªæ–½ï¼Œåœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œä»–å€‘é•èƒŒè‡ªå·±çš„é‚£ä¸€å¥—å† å†•å ‚çš‡çš„è¨€è©ï¼Œå±ˆå°Šæ‹¾å–é‡‘è˜‹æœï¼Œä¸é¡§ä¿¡ç¾©ã€ä»æ„›å’Œåè­½å»åšç¾Šæ¯›ã€ç´…èœé ­å’Œç‡’é…’çš„è²·è³£ã€‚<br>
æ­£å¦‚åƒ§ä¾¶ç¸½æ˜¯åŒå°å»ºä¸»æ”œæ‰‹åŒè¡Œä¸€æ¨£ï¼Œåƒ§ä¾¶çš„ç¤¾æœƒä¸»ç¾©ä¹Ÿç¸½æ˜¯åŒå°å»ºçš„ç¤¾æœƒä¸»ç¾©æ”œæ‰‹åŒè¡Œçš„ã€‚<br>
è¦çµ¦åŸºç£æ•™ç¦æ¬²ä¸»ç¾©å¡—ä¸Šä¸€å±¤ç¤¾æœƒä¸»ç¾©çš„è‰²å½©ï¼Œæ˜¯å†å®¹æ˜“ä¸éäº†ã€‚ åŸºç£æ•™ä¸æ˜¯ä¹Ÿæ¿€çƒˆåå°ç§æœ‰åˆ¶ï¼Œåå°å©šå§»ï¼Œåå°åœ‹å®¶å—ï¼Ÿ å®ƒä¸æ˜¯æå€¡ç”¨è¡Œå–„å’Œæ±‚ä¹ã€ç¨èº«å’Œç¦æ¬²ã€ä¿®é“å’Œç¦®æ‹œä¾†ä»£æ›¿é€™ä¸€åˆ‡å—ï¼Ÿ åŸºç£æ•™çš„ç¤¾æœƒä¸»ç¾©ï¼Œåªä¸éæ˜¯åƒ§ä¾¶ç”¨ä¾†ä½¿è²´æ—çš„æ€¨æ†¤ç¥è–åŒ–çš„è–æ°´ç½·äº†ã€‚<br>
ï¼ˆä¹™ï¼‰å°è³‡ç”¢éšç´šçš„ç¤¾æœƒä¸»ç¾©<br>
ï¼ˆå…§å®¹è¦‹åƒè€ƒè³‡æ–™9ï¼‰<br>
ï¼ˆä¸™ï¼‰å¾·åœ‹çš„æˆ–â€œçœŸæ­£çš„â€ç¤¾æœƒä¸»ç¾©<br>
ï¼ˆå…§å®¹è¦‹åƒè€ƒè³‡æ–™9ï¼‰</p>
          <p><a href="https://mlmmlm.icu/t/topic/1394/1">é˜…è¯»å®Œæ•´è¯é¢˜</a></p>
        ]]></description>
        <link>https://mlmmlm.icu/t/topic/1394/1</link>
        <pubDate>Wed, 07 Sep 2022 03:58:11 +0000</pubDate>
        <guid isPermaLink="false">mlmmlm.icu-post-1394-1</guid>
        <source url="https://mlmmlm.icu/t/topic/1394.rss">OTR XMPPèŠå¤©æ©Ÿå™¨äººâ€”â€”è­¦æƒ•XMPP-Matrixå‚€å„¡äººï¼ğŸ˜‚</source>
      </item>
  </channel>
</rss>
